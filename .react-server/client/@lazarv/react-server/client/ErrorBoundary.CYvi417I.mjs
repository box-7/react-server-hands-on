import{j as u}from"../../../jsx-runtime.1V7Smtlq.mjs";import{r as a,F as f,a as m,u as y,P as x}from"../../../react-server/client/context.BEW1agim.mjs";import"../../../react/jsx-runtime.CIru4pme.mjs";import"../../../react.BboN7MDb.mjs";const p=a.createContext(null);function T(){const r=a.useContext(p),[e,t]=a.useState({error:null,hasError:!1}),s=a.useMemo(()=>({resetBoundary:()=>{r.resetErrorBoundary(),t({error:null,hasError:!1})},showBoundary:n=>t({error:n,hasError:!0})}),[r.resetErrorBoundary]);if(e.hasError)throw e.error;return s}const l={didCatch:!1,error:null};class B extends a.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=l}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}async resetErrorBoundary(...e){const{error:t}=this.state;t!==null&&(await this.props.onReset?.({args:e,reason:"imperative-api",error:t,resetErrorBoundary:this.resetErrorBoundary}),typeof t?.digest!="string"&&this.setState(l))}componentDidCatch(e,t){this.props.onError?.(e,t)}componentDidUpdate(e,t){const{didCatch:s}=this.state,{resetKeys:n}=this.props;if(s&&t.error!==null&&g(e.resetKeys,n))if(typeof this.props.onReset=="function"){const c=this.props.onReset({next:n,prev:e.resetKeys,reason:"keys"});typeof c?.then=="function"?c.then(()=>{this.setState(l)}):this.setState(l)}else this.setState(l)}render(){const{children:e,fallbackRender:t,FallbackComponent:s,fallback:n}=this.props,{didCatch:c,error:o}=this.state;o?.message==="Redirect"&&o?.digest.startsWith("Location=")&&(o.redirectTo=o.digest.slice(9));let i=e;if(c){const d={error:o,resetErrorBoundary:this.resetErrorBoundary};if(delete o.stack,typeof t=="function")i=t(d);else if(s)i=a.createElement(s,d);else if(n===null||a.isValidElement(n))i=n;else throw o}return u.jsx(p.Provider,{value:{didCatch:c,error:o,resetErrorBoundary:this.resetErrorBoundary},children:i})}}function g(r=[],e=[]){return r.length!==e.length||r.some((t,s)=>!Object.is(t,e[s]))}function C({FallbackComponent:r,fallbackRender:e,...t}){const{outlet:s}=a.useContext(f),n=y(),{navigate:c}=n,{error:o}=t,{redirectTo:i}=o;return a.useEffect(()=>{i&&c(i,{outlet:s,external:s!==x})},[i,c,s]),i?null:u.jsxs(u.Fragment,{children:[r&&typeof r=="function"?u.jsx(r,{...t}):r,e?.(t)]})}function R({error:r}){if(r)throw r;return null}function b({component:r,render:e,onReset:t,global:s,children:n,...c}){const{outlet:o}=a.useContext(f),{resourceKey:i,error:d}=a.useContext(m),{invalidate:E}=y();return u.jsxs(B,{...c,onReset:async h=>{typeof h.error?.digest=="string"&&await E(o),t?.(h)},fallbackRender:h=>u.jsx(C,{FallbackComponent:r,fallbackRender:e,...h}),children:[u.jsx(R,{error:d}),n]},`${o}_${i}`)}export{B as ErrorBoundary,b as default,T as useErrorBoundary};
