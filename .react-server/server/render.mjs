import{jsx as p,Fragment as q,jsxs as Y}from"react/jsx-runtime";import{ReadableStream as me}from"node:stream/web";import b from"react-server-dom-webpack/server.edge";import{g as t,L as _e,R as Ce,C as Oe,a as Pe,H as xe,i as qe,b as be,u as Ne,F as ve,c as D,d as O,A as He,e as z,f as J,h as F,j as Q,S as Ae,k as Me,l as De,r as Fe,E as Ie,m as Le,n as N,o as pe,p as ke,q as V,s as Z,t as ee,v as te,w as he,x as re,P as $e,y as Ue,I as Xe,z as Re,M as Be}from"./@lazarv/react-server.CYwTf2yq.mjs";import"node:path";import"node:url";import"node:async_hooks";import"node:worker_threads";import"picocolors";const G=new Proxy({},{get(P,E){if(!P[E]){const[j,v]=E.split("#");P[E]={id:`server://${j}`,name:v,chunks:[]}}return P[E]}});async function Ze(P,E={},j={}){const v=t(_e),Te=t(Ce),I=t(Oe)?.[Pe];try{return new Promise(async(h,ne)=>{const e=t(xe);try{qe();const R=e.request.headers.get("origin"),ge=R&&new URL(R).protocol,oe=e.request.headers.get("host"),f=t(be),x=f.flags.isRemote,T=Ne();let H,A,y,ae;const K=e.request.headers.get("content-type")?.includes("multipart/form-data");let ye;const S=decodeURIComponent(e.request.headers.get("react-server-action")??null);if("POST,PUT,PATCH,DELETE".includes(e.request.method)&&(S&&S!=="null"||K)&&!j.skipFunction){let n=async function(){throw new Error("Server action not found")},o=[];if(K){const c={},m=await t(ve)(e.request,{handleFile:async({body:i,...s})=>{const a=[];for await(const u of i)a.push(u);const l=`__react_server_file_${s.name}__`;return c[l]={info:s,file:new Blob(a,{type:s.contentType})},l}}),d=new FormData;for(const[i,s]of m.entries())if(c[s]){const{info:a,file:l}=c[s];d.append(i,l,a.filename)}else d.append(i.replace(/^remote:/,""),s);try{o=await b.decodeReply(d,G)}catch{o=d}}else o=await b.decodeReply(await e.request.text(),G);if(S&&S!=="null"){const[c,m]=S.split("#");n=async()=>{try{return{data:await(await globalThis.__webpack_require__(c))[m].bind(null,...o)(),actionId:S,error:null}}catch(d){return{data:null,actionId:S,error:d}}}}else n=await b.decodeAction(o[o.length-1]??o,G);if(typeof n!="function"){const c=new Error("Server Function Not Found");throw c.digest=c.message,c}const{data:r,actionId:w,error:_}=await n();if(A=!0,!K)H=_?Promise.reject(_):r instanceof Buffer?r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength):r;else{const c=await b.decodeFormState(r,o[o.length-1]??o,G);if(c){const[m,d]=c;H=m,y={"React-Server-Action-Key":encodeURIComponent(d)}}else ae=!0,H=r instanceof Buffer?r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength):r}const C=t(D);if(f.flags.isHTML&&C?.response)return h(C.response);O(He,{formData:o[o.length-1]??o,data:r,error:_,actionId:w})}const ce=e.request.headers.get("if-modified-since"),W=e.request.headers.get("cache-control")==="no-cache",Ee=f.flags.isRSC?z:J;if(ce&&!W&&await t(F)?.get([e.url,"text/x-component",T,Ee,ce])!==Q)return h(new Response(null,{status:304,statusText:"Not Modified"}));const Se=x||/^https?___/.test(T)?void 0:"default",ie=I.base?n=>`/${I.base}/${n?.id||n}`.replace(/\/+/g,"/"):n=>n?.id||n,le=x||R&&oe!==R?n=>`${ge}//${oe}${ie(n)}`:ie,ue=()=>{const n=t(Ae);return p(q,{children:n.map(o=>{const r=le(o);return p("link",{rel:"stylesheet",href:r,precedence:Se},r)})})};let L=I.modulePreload??!0;typeof L=="function"&&(L=await L());const de=L!==!1?()=>{const n=t(Me);return p(q,{children:n.map(o=>p("link",{rel:"modulepreload",href:le(o)},o))})}:()=>null,fe=Y(q,{children:[p(ue,{}),p(de,{}),p(P,{...E})]}),k=t(De)??!1;k&&(y={...y,"React-Server-Render":k.url.toString(),"React-Server-Outlet":k.outlet});const $=t(D);$?.response&&(y={...y,"React-Server-Render":$.location,"React-Server-Outlet":"PAGE_ROOT"},Fe($.location));let U=fe;if(A&&f.flags.isRSC&&!f.flags.isRemote&&(y={...y,"React-Server-Data":"rsc"},U=k||$?.response||ae?Y(q,{children:[fe,H]}):p(q,{children:[H]})),!x&&!A&&(!T||T&&T==="PAGE_ROOT")){const n=t(Ie);if(n&&n.$$typeof===Symbol.for("react.client.reference")){const o=t(Le);o&&(U=Y(q,{children:[p(ue,{}),p(de,{}),p(o,{component:n,children:p(P,{...E})})]}))}}const X=new Date().toUTCString();if(f.flags.isRSC&&!f.flags.isRemote){if(!W&&!A){const r=await t(F)?.get([e.url,"text/x-component",T,z]);if(r!==Q)return h(new Response(r.buffer,{status:r.status,statusText:r.statusText,headers:r.headers}))}let n=!1;const o=new me({type:"bytes",async start(r){const w=t(N);O(N,new Headers({"content-type":"text/x-component; charset=utf-8","cache-control":e.request.headers.get("cache-control")==="no-cache"?"no-cache":"must-revalidate","last-modified":X,...y,...w?Object.fromEntries(w.entries()):{}}));const C=b.renderToReadableStream(U,pe({remote:x,origin:R}),{onError(u){n=!0;const g=t(D);return g?.response?`Location=${g.response.headers.get("location")}`:u?.message}}).getReader();let c=!1;const m=[],d=new Promise(u=>ke(()=>u("interrupt")));let i=null;for(;!c;){const u=i||C.read(),g=await Promise.race([u,t(V)??d]);if(g===V){O(V,null),i=u;continue}else if(g==="interrupt"){i=u;break}i=null;const{value:M,done:B}=g;c=B,M&&m.push(Z(M))}r.enqueue(new Uint8Array(ee(m)));const s=t(te)??{status:200,statusText:"OK"},a=t(N)??new Headers,l=new Response(o,{...s,headers:a});for(O(he,l),h(l);!c;){const{value:u,done:g}=await(i||C.read());i=null,c=g,u&&(m.push(Z(u)),r.enqueue(u))}r.close(),n||t(F)?.set([e.url,"text/x-component",T,z,X],{...s,buffer:ee(m),headers:a})}})}else if(f.flags.isHTML||f.flags.isRemote){if(!W&&!A){const s=await t(F)?.get([e.url,"text/html",T,J]);if(s!==Q){const a=new me({type:"bytes",async start(l){l.enqueue(new Uint8Array(s.buffer)),l.close()}});return h(new Response(a,{status:s.status,statusText:s.statusText,headers:s.headers}))}}const n=t(N);O(N,new Headers({"content-type":"text/html; charset=utf-8","cache-control":e.request.headers.get("cache-control")==="no-cache"?"no-cache":"must-revalidate","last-modified":X,...n?Object.fromEntries(n.entries()):{}}));let o=!1;const r=b.renderToReadableStream(U,pe({remote:x,origin:R}),{onError(s){o=!0;const a=t(D);return a?.response?h(a.response):s?.message}}),w=re.getStore(),{onPostponed:_}=e,C=t($e),c=t(Ue),m=t(Xe);let d=!1;const i=await Te({stream:r,bootstrapModules:f.flags.isRSC||f.flags.isRemote?[]:t(Be),bootstrapScripts:f.flags.isRSC||f.flags.isRemote?[]:[`const moduleCache = new Map();
                    self.__webpack_require__ = function (id) {
                      if (!moduleCache.has(id)) {
                        const modulePromise = /^https?\\:/.test(id) ? import(id) : import(("${`/${I.base??""}/`.replace(/\/+/g,"/")}" + id).replace(/\\/+/g, "/"));
                        modulePromise.then(
                          (module) => {
                            modulePromise.value = module;
                            modulePromise.status = "fulfilled";
                          },
                          (reason) => {
                            modulePromise.reason = reason;
                            modulePromise.status = "rejected";
                          }
                        );
                        moduleCache.set(id, modulePromise);
                      }
                      return moduleCache.get(id);
                    };`.replace(/\n/g,"")],outlet:T,defer:e.request.headers.get("react-server-defer")==="true",start:async()=>{d=!0,re.run(w,async()=>{const s=t(D);if(s?.response)return h(s.response);const a=t(te)??{status:200,statusText:"OK"},l=t(N)??new Headers,[u,g]=i.tee(),M=[];(async()=>{if(!o){for await(const we of g)M.push(Z(we));await t(F)?.set([e.url,"text/html",T,J,X],{...a,buffer:ee(M),headers:l})}})();const B=new Response(u,{...a,headers:l});O(he,B),h(B)})},onError(s,a){a&&(s.digest=a),(v??console).error(s),o=!0,d||re.run(w,async()=>{O(te,{status:500,statusText:"Internal Server Error"}),t(Re)?.(s)?.then(h,ne)})},formState:ye,isPrerender:typeof _=="function",onPostponed:_,prelude:C,postponed:c,remote:x,origin:R,importMap:m,httpContext:{request:{method:e.request.method,url:e.request.url,headers:Array.from(e.request.headers.entries()).reduce((s,[a,l])=>(s[a]=l,s),{}),destination:e.request.destination,referrer:e.request.referrer,referrerPolicy:e.request.referrerPolicy,mode:e.request.mode,credentials:e.request.credentials,cache:e.request.cache,redirect:e.request.redirect,integrity:e.request.integrity,keepalive:e.request.keepalive,isReloadNavigation:e.request.isReloadNavigation,isHistoryNavigation:e.request.isHistoryNavigation},ip:e.ip,method:e.method,url:e.url.toString()}})}else return h(new Response(null,{status:404,statusText:"Not Found"}))}catch(R){v.error(R),t(Re)?.(R)?.then(h,ne)}})}catch(se){return v.error(se),new Response(null,{status:500,statusText:"Internal Server Error"})}}export{Ze as render};
